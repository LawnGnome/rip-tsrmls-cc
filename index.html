<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>RIP TSRMLS_CC</title>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="reveal.js/css/reveal.css">
		<link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">

		<!-- CSS overrides -->
		<link rel="stylesheet" href="css/style.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="reveal.js/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<div class="slides">
				<section id="title">
          <h2>Welcome to the new age</h2>
					<h1>RIP <code>TSRMLS_CC</code></h1>
					<h3>
						Adam Harvey
						<br>
						<a href="https://twitter.com/LGnome">@LGnome</a>
						<br>
						<a href="http://newrelic.com">New Relic</a>
					</h3>
				</section>

				<section data-background="images/Woolly_mammoth.jpg">
					<section id="php7">
						<aside class="notes">
							PHP 7 came out in December 2015. It's been kept quiet, but you
							may have heard of it.
						</aside>
					</section>

					<section id="api-churn" data-background="translucent">
						<h2>API churn</h2>
						<ul>
							<li>333 functions/macros removed</li>
							<li>410 functions/macros added</li>
						</ul>
						<aside class="notes">
							In userland, we did a good job of maintaining backward
							compatibility, but that wasn't the case for the API exposed by
							the Zend Engine and PHP itself. 333 functions is almost exactly
							one quarter of the functions and macros exposed by PHP 5.6.
						</aside>
					</section>

					<section id="api-diff" data-background="translucent">
						<h2>API churn</h2>
						<ul>
							<li>516 out of 990 functions/macros differ</li>
						</ul>
            <aside class="notes">
              Here's the more insidious bit: more than half of the functions
              that kept the same name have changed. (And that excluded
              TSRM-related noise.) Different types, different numbers of
              parameters, different return values. Most don't matter, but some
              <em>really</em> do.
            </aside>
					</section>
				</section>

        <section data-background="images/geograph-3799604-by-Peter-.jpg">
          <section id="what-do">
            <aside class="notes">
              So, now that I've thoroughly terrified you, what do you do with
              your PHP 4 or 5 era extension that your site relies on?
            </aside>
          </section>

          <section id="options" data-background="translucent">
            <h2>What do?</h2>
            <ul>
              <li>One way migration</li>
              <li>Separate branches</li>
              <li>Shared codebase</li>
              <li class="fragment">Ignore PHP 7 and hope it goes away</li>
            </ul>
            <aside class="notes">
              The way I see it, you have three real options.
              (pause)
              I guess there's a fourth.
            </aside>
          </section>
        </section>

        <section data-background="images/road-street-sign-way.jpg">
          <section id="one-way">
          </section>
          <aside class="notes">
            Let's look at the pros and cons of each in turn. First up: one way
            migration.
          </aside>

          <section id="one-way-advantages" data-background="translucent">
            <h2>Advantages</h2>
            <ul>
              <li>One time cost</li>
              <li>Conceptually simple</li>
              <li>Cleaner code</li>
            </ul>
          </section>

          <section id="one-way-disadvantages" data-background="translucent">
            <h2>Disadvantages</h2>
            <ul>
              <li>You no longer support PHP 5</li>
            </ul>
            <aside class="notes">
              Not supporting PHP 5 may not be a huge issue if you're only
              supporting something internal: if you're planning to do a hard
              cut over, that works. Although I'm not going to talk a lot about
              this option as we go on, the things I highlight are also things
              you'd want to do with this option.
            </aside>
          </section>
        </section>

        <section data-background="images/branches.jpg">
          <section id="branches">
            <aside class="notes">
              Maintaining parallel branches is another option.
            </aside>
          </section>

          <section id="branches-advantages" data-background="translucent">
            <h2>Advantages</h2>
            <ul>
              <li>Both versions are supported</li>
              <li>Able to write idiomatic code for both versions</li>
            </ul>
          </section>

          <section id="branches-disadvantages" data-background="translucent">
            <h2>Disadvantages</h2>
            <ul>
              <li>Maintenance is a pain</li>
              <li>Potentially double the work</li>
              <li>Branches may diverge over time</li>
            </ul>
            <aside class="notes">
              This might work if you have almost everything abstracted away,
              but if you do, the parts of your code that interface with PHP are
              probably so simple anyway that you could just support both
              versions in the one branch.
            </aside>
          </section>
        </section>

        <section data-background="images/hammer.jpg">
          <section id="shared">
            <aside class="notes">
              Finally (excluding ignoring PHP 7), you can run a shared codebase.
            </aside>
          </section>

          <section id="shared-advantages" data-background="translucent">
            <h2>Advantages</h2>
            <ul>
              <li>Both versions are supported</li>
              <li>Less maintenance overhead</li>
              <li>Happy users</li>
            </ul>
            <aside class="notes">
              Happy users because they can just download the latest release; cf
              memcached.
            </aside>
          </section>

          <section id="shared-disadvantages" data-background="translucent">
            <h2>Disadvantages</h2>
            <ul>
              <li>So many API changes</li>
            </ul>
            <aside class="notes">
              I'm going to delve deeper into this. There are ways you can
              mitigate the API changes &mdash; how hard it is depends a lot on
              what type of extension you're writing. Simple C library wrappers:
              not too bad. Deep voodoo magic extensions: bad (but still
              doable).
            </aside>
          </section>
        </section>

        <section>
          <section id="questions">
            <h1>Thank you!</h1>
            <h2>Questions?</h2>
						<a href="https://twitter.com/LGnome">@LGnome</a>
          </section>

          <section id="image-credits">
            <h2>Image credits</h2>
            <div></div>
          </section>
        </section>
			</div>
		</div>

		<script src="reveal.js/lib/js/head.min.js"></script>
		<script src="reveal.js/js/reveal.js"></script>

    <script src="js/jquery-2.2.0.min.js"></script>
    <script src="js/images.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: (-1 == window.location.host.indexOf("localhost") && -1 == window.location.host.indexOf("0.0.0.0")),
				progress: false,
				history: true,
				center: true,
				width: 1280,
				height: 720,

				transition: 'fade', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
					{ src: 'reveal.js/plugin/notes/notes.js', async: true }
				]
			});

      $("#image-credits > div").imageCredits();

		</script>
	</body>
</html>
<!-- vim: set nocin ai noet ts=2 sw=2: -->
